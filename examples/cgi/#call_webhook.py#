#!/usr/bin/python3

import cgi
import requests as req
import os


def get_cookie():
    for cookie in os.environ.get('HTTP_COOKIE').split(';'):
        if 'SSID' in cookie:
            return cookie.strip()
    return 'None'


def get_id():
    form = cgi.FieldStorage()
    id = form.getvalue("id")
    return id


def get_url_auth(cookie):
    url = "https://example.com/sapi?_r=account&_m=get-wh-settings"
    headers = {"Cookie": cookie}
    response = req.get(url, headers=headers)
    data = response.json()
    url = data["Url"]
    auth = data["Auth"]
    return url, auth


def get_data(id, cookie):
    url = "https://example.com/sapi?_r=data&_m=get-sums&id=" + str(id)
    headers = {'Cookie': cookie}
    response = req.get(url, headers=headers)
    data = response.json()
    return data


def post_data(url, auth, data):
    headers = {'Authorization': auth}
    response = req.post(url, headers=headers, json=data)
    return response.text


def main():
    cookie = get_cookie()
    id = get_id()
    url, auth = get_url_auth(cookie)
    data = get_data(id, cookie)
    response = post_data(url, auth, data)
    print(response)


if __name__ == "__main__":
    main()


    